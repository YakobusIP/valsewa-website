components:
  schemas:
    Account:
      type: object
      required:
        - id
        - username
        - nickname
        - accountCode
        - accountRank
        - availabilityStatus
      properties:
        id:
          type: number
        username:
          type: string
        nickname:
          type: string
        accountCode:
          type: string
        description:
          type: string
        accountRank:
          type: string
        availabilityStatus:
          type: string
        currentBookingDate:
          type: string
          format: date-time
        currentBookingDuration:
          type: number
        currentExpireAt:
          type: string
          format: date-time
        nextBookingDate:
          type: string
          format: date-time
        nextBookingDuration:
          type: number
        nextExpireAt:
          type: string
          format: date-time
        totalRentHour:
          type: number
        password:
          type: string
        skinList:
          type: array
          items:
            type: Skin
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    PublicAccount:
      type: object
      required:
        - id
        - username
        - nickname
        - accountCode
        - accountRank
        - availabilityStatus
      properties:
        id:
          type: number
        username:
          type: string
        nickname:
          type: string
        accountCode:
          type: string
        description:
          type: string
        accountRank:
          type: string
        availabilityStatus:
          type: string
        currentExpireAt:
          type: string
          format: date-time
        totalRentHour:
          type: number
        skinList:
          type: array
          items:
            type: string

    AccountResetLog:
      type: object
      required:
        - id
        - accountId
        - previousExpireAt
        - resetAt
      properties:
        id:
          type: number
        accountId:
          type: number
        account:
          type: object
          properties:
            username:
              type: string
            accountCode:
              type: string
        previousExpireAt:
          type: string
          format: date-time
        resetAt:
          type: string
          format: date-time

    TokenPayload:
      type: object
      properties:
        username:
          type: string

    AuthResponse:
      type: object
      properties:
        accessToken:
          type: string
        username:
          type: string
        refreshToken:
          type: string

    LogoutResponse:
      type: object
      properties:
        message:
          type: string

    RefreshResponse:
      type: object
      properties:
        accessToken:
          type: string
        refreshToken:
          type: string

    PriceTier:
      type: object
      required:
        - id
        - code
        - description
      properties:
        id:
          type: number
        code:
          type: string
        priceList:
          type: array
          items: 
            $ref: "#/components/schemas/PriceList"
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    PriceList:
      type: object
      properties:
      id:
        type: number
      duration:
        type: string
        pattern: '^(\d+d)?\s?(\d+h)?$'
        example: "1d 2h"
      normalPrice:
        type: number
      lowPrice:
        type: number
      tierId:
        type: number

    PriceTierCreateRequest:
      type: object
      description: "Create a price tier and optionally its price list items."
      properties:
        code:
          type: string
          example: "C"
        priceList:
          type: array
          items:
            $ref: "#/components/schemas/PriceListCreateWithoutTier"
      required:
        - code

    PriceTierUpdateRequest:
      type: object
      description: "Update price tier. If replacePriceList is provided, replaces all existing items."
      properties:
        code:
          type: string
          example: "C"
        replacePriceList:
          type: array
          items:
            $ref: "#/components/schemas/PriceListCreateWithoutTier"
      additionalProperties: false

    PriceListCreateWithoutTier:
      type: object
      description: "Create a price list item when tierId is supplied via the path."
      properties:
        duration:
          type: string
          pattern: "^(\\d+d)?\\s?(\\d+h)?$"
          example: "1d 0h"
        normalPrice:
          type: number
          example: 99900
        lowPrice:
          type: number
          example: 79900
      required:
        - duration
        - normalPrice
        - lowPrice

    PriceListBulkCreateRequest:
      type: object
      description: "Bulk create price list items for a tier."
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/PriceListCreateWithoutTier"
      required:
        - items
      example:
        items:
          - { duration: "1d 2h", normalPrice: 99000, lowPrice: 79000 }
          - { duration: "0d 12h", normalPrice: 54900, lowPrice: 44900 }

    PriceListUpdate:
      type: object
      description: "Partial or full update for a price list item."
      properties:
        duration:
          type: string
          pattern: "^(\\d+d)?\\s?(\\d+h)?$"
          example: "2d 0h"
        normalPrice:
          type: number
          example: 102000
        lowPrice:
          type: number
          example: 82000
      additionalProperties: false

    IdsDeleteRequest:
      type: object
      description: "IDs payload for delete-many operations."
      properties:
        ids:
          type: array
          items:
            type: number
          example: [1, 2, 3]
      required:
        - ids

    PriceListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: "#/components/schemas/PriceList"
        metadata:
          type: object
          description: "Extra metadata when listing items by tier."
          properties:
            tierId:
              type: number
              example: 10
      required:
        - data

    PriceListBulkCreateResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: "#/components/schemas/PriceList"
        message:
          type: string
          example: "Price list items created."
      required:
        - data
        - message

    PriceListUpdateResponse:
      type: object
      properties:
        data:
          $ref: "#/components/schemas/PriceList"
        message:
          type: string
          example: "Price list item updated."
      required:
        - data
        - message

    
    Skin:
      type: object
      properties:
      id:
        type: number
      name:
        type: string
      image:
        type: string
      keyword:
        type: string
        description: "Comma-separated keywords. Example: 'ion, vandal, zedd phantom'"

    SkinCreate:
      type: object
      properties:
        name:
          type: string
          example: "Prime Vandal"
        keyword:
          type: string
          example: "prime, vandal"
        image:
          type: string
          example: "https://media.valorant-api.com/weaponskinlevels/c9678d8c-4327-f397-b0ec-dca3c3d6fb15/displayicon.png"
      required:
        - name
        - keyword
        - image

    SkinUpdate:
      type: object
      properties:
        name:
          type: string
          example: "Prime Vandal (Updated)"
        image:
          type: string
          example: "https://cdn.example/prime-vandal-new.png"
        keyword:
          type: string
          example: "prime"
      description: All fields are optional; only provided properties will be updated.



    Statistic:
      type: object
      properties:
        rentedRatio:
          type: number
          description: "Percentage ratio of accounts currently in use."
        availableAccounts:
          type: number
          description: "Number of accounts available."
        inUseAccounts:
          type: number
          description: "Number of accounts in use."
        totalAccounts:
          type: number
          description: "Total number of accounts."

    ImageUpload:
      type: object
      required:
        - id
        - imageUrl
      properties:
        id:
          type: number
        imageUrl:
          type: string
          description: "URL of the uploaded image."
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    Metadata:
      type: object
      properties:
        page:
          type: number
        limit:
          type: number
        pageCount:
          type: number
        total:
          type: number

    BookingStatus:
      type: string
      enum: [HOLD, RESERVED, EXPIRED, FAILED, CANCELLED, COMPLETED]

    DurationType:
      type: string
      enum: [HOURLY, DAILY]

    PaymentStatus:
      type: string
      enum: [PENDING, SUCCESS, EXPIRED, FAILED, CANCELLED, REFUNDED]

    Provider:
      type: string
      enum: [FASPAY, MANUAL]

    PaymentMethodType:
      type: string
      enum: [QRIS, VIRTUAL_ACCOUNT, MANUAL]

    Type:
      type: string
      enum: [PERSENTASE, NOMINAL]

    CreateBookingRequest:
      type: object
      required: [userId, accountId, priceListId, quantity]
      properties:
        userId: { type: integer }
        accountId: { type: integer }
        priceListId: { type: integer }
        quantity: { type: integer }
        voucherId: { type: integer }
        startAt: { type: string, format: date-time }

    PayBookingRequest:
      type: object
      required: [bookingId, provider, paymentMethod]
      properties:
        bookingId: { type: string, format: cuid }
        voucherId: { type: integer }
        provider: { $ref: '#/components/schemas/Provider' }
        paymentMethod: { $ref: '#/components/schemas/PaymentMethodType' }
        bankCode: { type: string }
        bankAccountName: { type: string }

    BookingResponse:
      type: object
      properties:
        id: { type: string, format: cuid }
        userId: { type: integer, nullable: true }
        accountId: { type: integer }
        status: { $ref: '#/components/schemas/BookingStatus' }
        duration: { type: string }
        quantity: { type: integer }
        startAt: { type: string, format: date-time, nullable: true }
        endAt: { type: string, format: date-time, nullable: true }
        expiredAt: { type: string, format: date-time, nullable: true }
        mainValuePerUnit: { type: integer }
        othersValuePerUnit: { type: integer, nullable: true }
        voucherId: { type: integer }
        voucherType: { $ref: '#/components/schemas/Type' }
        voucherAmount: { type: integer }
        voucherMaxDiscount: { type: integer }
        mainValue: { type: integer }
        othersValue: { type: integer }
        totalValue: { type: integer }
        account: { type: integer, nullable: true }

    PaymentResponse:
      type: object
      properties:
        paymentId: { type: string, format: cuid }
        bookingId: { type: string, format: cuid }
        status: { $ref: '#/components/schemas/PaymentStatus' }
        value: { type: integer }
        currency: { type: string, example: "IDR" }
        provider: { $ref: '#/components/schemas/Provider' }
        providerPaymentId: { type: string }
        paymentMethod: { $ref: '#/components/schemas/PaymentMethodType' }
        qrUrl: { type: string, format: uri, nullable: true }
        paidAt: { type: string, format: date-time, nullable: true }
        refundedAt: { type: string, format: date-time, nullable: true }

    ErrorResponse:
      type: object
      properties:
        error:
          type: string

  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

    apiKeyAuth:
      type: apiKey
      in: header
      name: api-key

paths:
  /api/accounts:
    get:
      tags:
        - Accounts
      summary: "Retrieve a paginated list of accounts."
      security:
        - bearerAuth: []
      description: "Retrieves accounts with optional filtering and sorting."
      parameters:
        - in: query
          name: page
          required: true
          schema:
            type: string
          description: "The page number."
        - in: query
          name: limit
          required: true
          schema:
            type: string
          description: "The number of accounts per page."
        - in: query
          name: q
          required: false
          schema:
            type: string
          description: "Optional search query."
        - in: query
          name: sortBy
          required: false
          schema:
            type: string
          description: "Field name to sort by (e.g., availability, rank, price_tier, id_tier)."
        - in: query
          name: direction
          required: false
          schema:
            type: string
          description: "Sort order (asc or desc)."
      responses:
        "200":
          description: "A list of accounts with pagination metadata."
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/Account"
                  metadata:
                    $ref: "#/components/schemas/Metadata"
    post:
      tags:
        - Accounts
      summary: "Create a new account."
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Account"
      responses:
        "201":
          description: "Account created successfully."
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
    delete:
      tags:
        - Accounts
      summary: "Delete multiple accounts."
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                ids:
                  type: array
                  items:
                    type: number
      responses:
        "204":
          description: "Accounts deleted successfully."

  /api/accounts/public:
    get:
      tags:
        - Accounts
      summary: "Retrieve a paginated list of public accounts."
      description: "Retrieves public accounts with optional filtering and sorting."
      parameters:
        - in: query
          name: page
          required: true
          schema:
            type: string
          description: "The page number."
        - in: query
          name: limit
          required: true
          schema:
            type: string
          description: "The number of accounts per page."
        - in: query
          name: q
          required: false
          schema:
            type: string
          description: "Optional search query."
        - in: query
          name: sortBy
          required: false
          schema:
            type: string
          description: "Field name to sort by."
        - in: query
          name: direction
          required: false
          schema:
            type: string
          description: "Sort order (asc or desc)."
      responses:
        "200":
          description: "A list of public accounts with pagination metadata."
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/PublicAccount"
                  metadata:
                    $ref: "#/components/schemas/Metadata"

  /api/accounts/{id}:
    get:
      tags:
        - Accounts
      summary: "Retrieve a single account by ID."
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: "The unique identifier of the account."
      responses:
        "200":
          description: "The account details."
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Account"
    put:
      tags:
        - Accounts
      summary: "Update an existing account."
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: "The ID of the account to update."
        - in: query
          name: deleteResetLogs
          required: false
          schema:
            type: boolean
          description: "Optional flag to delete reset logs."
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Account"
      responses:
        "201":
          description: "Account updated successfully."
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string

  /api/accounts/{id}/skins:
    post:
      tags: [Accounts]
      summary: Add skins to an account (IDs only)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
          description: Account ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                skinList:
                  type: array
                  items: { type: integer }
              required: [skinList]
            examples:
              example:
                value:
                  skinList: [1, 2, 3]
      responses:
        "200":
          description: Account with updated skin list
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      id: { type: integer }
                      skinList:
                        type: array
                        items:
                          $ref: "#/components/schemas/Skin"
        "400": { description: Invalid payload }
        "401": { description: Unauthorized }
        "404": { description: Account not found }
  
    delete:
      tags: [Accounts]
      summary: Remove skins from an account (IDs only)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                skinList:
                  type: array
                  items: { type: integer }
              required: [skinList]
      responses:
        "200": { description: Account with updated skin list }

  /api/accounts/{id}/finish-booking:
    post:
      tags:
        - Accounts
      summary: "Finish booking for an account."
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: "The ID of the account."
      responses:
        "201":
          description: "Booking finished."
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string

  /api/accounts/rank/{name}/{tag}:
    get:
      tags:
        - Accounts
      summary: "Retrieve an account's rank."
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: name
          required: true
          schema:
            type: string
          description: "The account's name."
        - in: path
          name: tag
          required: true
          schema:
            type: string
          description: "The account's tag."
      responses:
        "200":
          description: "The account's rank information."
          content:
            application/json:
              schema:
                type: object
                properties:
                  name:
                    type: string
                  tag:
                    type: string
                  currentRank:
                    type: string

  /api/accounts/duplicate/{name}/{tag}/{code}:
    get:
      tags:
        - Accounts
      summary: "Retrieve a duplicate check for an account."
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: name
          required: true
          schema:
            type: string
          description: "The account's name."
        - in: path
          name: tag
          required: true
          schema:
            type: string
          description: "The account's tag."
        - in: path
          name: code
          required: true
          schema:
            type: string
          description: "The account's code."
      responses:
        "200":
          description: "Returns true if duplicate account is found."
          content:
            application/json:
              schema:
                type: object
                properties:
                  exists:
                    type: boolean

  /api/accounts/failed-jobs:
    get:
      tags:
        - Accounts
      summary: "Retrieve failed account rank update jobs."
      security:
        - bearerAuth: []
      responses:
        "200":
          description: "A list of failed account rank update jobs."
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: string
                      description: "The ID of the failed job."
                    data:
                      type: object
                      description: "The job data payload."
                    failedReason:
                      type: string
                      description: "The reason for the job failure."
                    timestamp:
                      type: integer
                      format: int64
                      description: "The timestamp of the failed job."
                    accountCode:
                      type: string
                      nullable: true
                      description: "The account code associated with the job, if available."
                    username:
                      type: string
                      nullable: true
                      description: "The username associated with the job, if available."

  /api/accounts/reset-logs:
    get:
      tags:
        - Accounts
      summary: "Retrieve account reset logs."
      security:
        - bearerAuth: []
      responses:
        "200":
          description: "Account reset logs retrieved successfully."
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/AccountResetLog"

  /api/accounts/update-rank:
    post:
      tags:
        - Accounts
      summary: "Update the rank for all accounts."
      security:
        - apiKeyAuth: []
      responses:
        "200":
          description: "Successfully updated ranks for all accounts."
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string

  /api/accounts/update-expire-at:
    post:
      tags:
        - Accounts
      summary: "Update the expire at for expired accounts."
      security:
        - apiKeyAuth: []
      responses:
        "200":
          description: "Successfully updated expire at for all expired accounts."

  /api/accounts/reset-logs/{id}:
    put:
      tags:
        - Accounts
      summary: "Update account reset logs."
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: "The ID of the account reset log to update."
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Account"
      responses:
        "201":
          description: "Account reset logs updated successfully."
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string

  /api/auth/login:
    post:
      tags:
        - Authentication
      summary: "Login a user."
      description: "Authenticates a user using username and password and returns access and refresh tokens."
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - username
                - password
              properties:
                username:
                  type: string
                password:
                  type: string
      responses:
        "200":
          description: "Successful login."
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthResponse"
        "400":
          description: "Invalid request body."
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: "Invalid credentials."
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /api/auth/logout:
    post:
      tags:
        - Authentication
      summary: "Logout a user."
      description: "Clears the refresh token cookie to log out the user."
      responses:
        "200":
          description: "Logged out successfully."
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LogoutResponse"

  /api/auth/validate-token:
    get:
      tags:
        - Authentication
      summary: "Validate an access token."
      description: "Validates the provided access token from the Authorization header."
      parameters:
        - in: header
          name: Authorization
          required: true
          schema:
            type: string
          description: "Bearer token in the format 'Bearer {token}'."
      responses:
        "200":
          description: "Token is valid."
          content:
            application/json:
              schema:
                type: object
                properties:
                  username:
                    type: string
        "401":
          description: "Invalid token."
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /api/auth/refresh-token:
    post:
      tags:
        - Authentication
      summary: "Refresh the access token."
      description: "Uses the refresh token from cookies to generate a new access token."
      responses:
        "200":
          description: "New access token generated."
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RefreshResponse"
        "403":
          description: "Session timed out or invalid refresh token."
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /api/price-tiers:
    get:
      tags:
        - Price Tiers
      summary: "Retrieve a paginated list of price tiers."
      security:
        - bearerAuth: []
      description: "Returns a list of price tiers along with pagination metadata. Optionally filters by a search query."
      parameters:
        - in: query
          name: page
          required: false
          schema:
            type: string
          description: "The page number for pagination."
        - in: query
          name: limit
          required: false
          schema:
            type: string
          description: "The number of items per page."
        - in: query
          name: q
          required: false
          schema:
            type: string
          description: "Optional search query."
      responses:
        "200":
          description: "A list of price tiers with pagination metadata."
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/PriceTier"
                  metadata:
                    $ref: "#/components/schemas/Metadata"
    post:
      tags:
        - Price Tiers
      summary: "Create a new price tier."
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PriceTier"
      responses:
        "201":
          description: "Price tier created successfully."
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
    delete:
      tags:
        - Price Tiers
      summary: "Delete multiple price tiers."
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/IdsDeleteRequest"
      responses:
        "204":
          description: "Price tiers deleted successfully."
        "500":
          description: "Server error."
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"


  /api/price-tiers/{id}:
    get:
      tags:
        - Price Tiers
      summary: "Retrieve a price tier by ID."
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: "The unique identifier of the price tier."
      responses:
        "200":
          description: "The details of the price tier."
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/PriceTier"
    put:
      tags:
        - Price Tiers
      summary: "Update an existing price tier."
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: "The ID of the price tier to update."
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PriceTierUpdateRequest"
      responses:
        "201":
          description: "Price tier updated successfully."
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string

    delete:
      tags:
        - Price Tiers
      summary: "Delete multiple price tiers."
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                ids:
                  type: array
                  items:
                    type: number
      responses:
        "204":
          description: "Price tiers deleted successfully."
  
  /api/price-tiers/{tierId}/price-list:
    get:
      tags:
        - Price List
      summary: "List price list items for a tier."
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: tierId
          required: true
          schema:
            type: string
          description: "The ID of the price tier."
      responses:
        "200":
          description: "Price list items for the tier."
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PriceListResponse"
        "404":
          description: "Tier not found."
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "500":
          description: "Server error."
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
    post:
      tags:
        - Price List
      summary: "Bulk create price list items for a tier."
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: tierId
          required: true
          schema:
            type: string
          description: "The ID of the price tier."
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PriceListBulkCreateRequest"
      responses:
        "201":
          description: "Price list items created."
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PriceListBulkCreateResponse"
        "400":
          description: "Validation error."
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: "Tier not found."
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "500":
          description: "Server error."
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /api/price-list/{id}:
    put:
      tags:
        - Price List
      summary: "Update a single price list item."
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: "The ID of the price list item."
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PriceListUpdate"
      responses:
        "200":
          description: "Price list item updated."
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PriceListUpdateResponse"
        "404":
          description: "Item not found."
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "500":
          description: "Server error."
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /api/price-list:
    delete:
      tags:
        - Price List
      summary: "Delete multiple price list items."
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/IdsDeleteRequest"
      responses:
        "204":
          description: "Price list items deleted successfully."
        "500":
          description: "Server error."
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"


  /api/skins:
    get:
      tags:
        - Skins
      summary: Retrieve a paginated list of Skins
      description: Returns a list of skins with pagination metadata. Optionally filters by search query `q`.
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: page
          required: false
          schema:
            type: string
          description: The page number for pagination.
        - in: query
          name: limit
          required: false
          schema:
            type: string
          description: The number of items per page.
        - in: query
          name: q
          required: false
          schema:
            type: string
          description: Optional search query.
      responses:
        "200":
          description: A list of skins with pagination metadata.
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/Skin"
                  metadata:
                    $ref: "#/components/schemas/Metadata"
              examples:
                example:
                  value:
                    data:
                      - id: 1
                        name: "Prime Vandal"
                        image: "https://media.valorant-api.com/weaponskins/prime-vandal.png"
                        keyword: "prime"
                      - id: 2
                        name: "Nebula Phantom"
                        image: "https://media.valorant-api.com/weaponskins/nebula-phantom.png"
                        keyword: "nebula"
                    metadata:
                      page: 1
                      limit: 10
                      totalItems: 2
                      totalPages: 1
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

    post:
      tags:
        - Skins
      summary: Create a new skin (name & keyword). Image is enriched server-side.
      description: >
        Creates a skin using `name` and `keyword`.  
        The server will call the Valorant weapons endpoint to find a matching skin and store the image URL.  
        If the image is not found, the record is **still created** and a **warning** is returned with `201`.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SkinCreate"
            examples:
              example:
                value:
                  name: "Prime Vandal"
                  keyword: "prime"
                  image: "https://media.valorant-api.com/weaponskinlevels/c9678d8c-4327-f397-b0ec-dca3c3d6fb15/displayicon.png"
      responses:
        "201":
          description: Skin created.
          content:
            application/json:
              schema:
                oneOf:
                  # Your controller returns a message in the normal success path
                  - type: object
                    properties:
                      message:
                        type: string
                        example: "Skin created successfully!"
                  # Partial success (image not found): controller returns data + warning
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          id:
                            type: integer
                            example: 10
                          name:
                            type: string
                            example: "MadeUp Skin"
                          keyword:
                            type: string
                            example: "kw"
                          image:
                            type: string
                            description: Empty string when image not found.
                            example: ""
                      warning:
                        type: string
                        example: "Image for skin MadeUp Skin not found. Record saved."
        "400":
          description: Bad Request (validation error)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "409":
          description: Conflict (duplicate name)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

    delete:
      tags:
        - Skins
      summary: Delete multiple skins.
      description: Accepts a list of skin IDs to delete in one request.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                ids:
                  type: array
                  items:
                    type: number
              required:
                - ids
            examples:
              example:
                value:
                  ids: [1, 2, 3]
      responses:
        "204":
          description: Skins deleted successfully (no response body).
        "400":
          description: Bad Request (missing or invalid ids)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /api/skins/{id}:
    get:
      tags:
        - Skins
      summary: Retrieve a skin by ID.
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: The unique identifier of the skin.
      responses:
        "200":
          description: The details of the skin.
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/Skin"
              examples:
                example:
                  value:
                    data:
                      id: 1
                      name: "Prime Vandal"
                      image: "https://media.valorant-api.com/weaponskins/prime-vandal.png"
                      keyword: "prime"
        "404":
          description: Skin not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

    put:
      tags:
        - Skins
      summary: Update an existing skin.
      description: Updates a skinâ€™s fields. Your controller responds with a message.
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: The ID of the skin to update.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SkinUpdate"
            examples:
              example:
                value:
                  name: "Prime Vandal (Updated)"
                  keyword: "prime"
                  image: "https://cdn.example/prime-vandal-new.png"
      responses:
        "201":
          description: Skin updated successfully.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Skin updated successfully!"
        "400":
          description: Bad Request (validation error)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Skin not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "409":
          description: Conflict (duplicate name)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  
  /api/skins/image:
    get:
      tags:
        - Skins
      summary: Get a skin's image URL by name (query parameter).
      description: >
        Resolves the image URL for a given skin name (case-insensitive).  
        Prefers `levels.displayIcon`; falls back to `chromas.fullRender`.  
        Returns 404 if the skin (or image) could not be found.
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: name
          required: true
          schema:
            type: string
          description: Skin name to look up, e.g. "Prime Vandal".
      responses:
        "200":
          description: Skin image URL resolved.
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      name:
                        type: string
                        example: Prime Vandal
                      imageUrl:
                        type: string
                        example: https://media.valorant-api.com/.../displayicon.png
        "404":
          description: Skin or image not found.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "422":
          description: Validation or upstream unavailability/rate-limit.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "500":
          description: Internal server error.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /api/statistics:
    get:
      tags:
        - Statistics
      summary: "Retrieve account statistics."
      security:
        - bearerAuth: []
      description: "Returns statistics on account availability and calculates the rented ratio."
      responses:
        "200":
          description: "Statistics successfully retrieved."
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Statistic"

  /api/upload:
    post:
      tags:
        - Uploads
      summary: "Upload image(s)."
      security:
        - bearerAuth: []
      description: "Accepts one or more image files uploaded via multipart/form-data and returns the uploaded image information."
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                files:
                  type: array
                  items:
                    type: string
                    format: binary
      responses:
        "200":
          description: "Image(s) uploaded successfully."
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ImageUpload"
        "400":
          description: "No files uploaded or invalid request."
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  # --- Booking Endpoints ---
  /api/bookings/{id}:
    get:
      tags: [Bookings]
      summary: Get booking by ID
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: cuid
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BookingResponse'

  /api/bookings/users/{userId}:
    get:
      tags: [Bookings]
      summary: Get all bookings for a user
      security:
        - bearerAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: integer
      responses:
        "200":
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/BookingResponse'

  /api/bookings/users/hold-bookings/{userId}:
    get:
      tags: [Bookings]
      summary: Get only bookings with HOLD status for a user
      security:
        - bearerAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: integer
      responses:
        "200":
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/BookingResponse'

  /api/bookings/book:
    post:
      tags: [Bookings]
      summary: Create a new booking
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateBookingRequest'
      responses:
        "201":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BookingResponse'

  /api/bookings/cancel:
    post:
      tags: [Bookings]
      summary: Cancel booking
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [bookingId]
              properties:
                bookingId:
                  type: string
                  format: cuid
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BookingResponse'

  # --- Payment Endpoints ---
  /api/bookings/payments/{id}:
    get:
      tags: [Payments]
      summary: Get payment by ID
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: cuid
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentResponse'

  /api/bookings/active-payments/{bookingId}:
    get:
      tags: [Payments]
      summary: Get active payment by booking ID
      security:
        - bearerAuth: []
      parameters:
        - name: bookingId
          in: path
          required: true
          schema:
            type: string
            format: cuid
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentResponse'

  /api/bookings/pay:
    post:
      tags: [Payments]
      summary: Initiate payment for a booking
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PayBookingRequest'
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentResponse'

  /api/bookings/verify-payment:
    post:
      tags: [Payments]
      summary: Manually verify payment status
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [paymentId]
              properties:
                paymentId:
                  type: string
                  format: cuid
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentResponse'

  /api/bookings/force-pay:
    post:
      tags: [Payments]
      summary: Manually verify payment status
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [paymentId]
              properties:
                paymentId:
                  type: string
                  format: cuid
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentResponse'

  /api/bookings/sync-expired:
    post:
      tags: [Bookings]
      summary: Sync expired bookings
      security:
        - bearerAuth: []
      responses:
        "200":
          content:
            application/json:
              schema:
                type: object
                properties:
                  count: { type: integer }

  /api/bookings/faspay/callback:
    post:
      tags: [Webhooks]
      summary: Faspay Payment Notification Webhook
      responses:
        "200":
          description: Acknowledged
          content:
            application/json:
              schema:
                type: object
                properties:
                  response: { type: string }
                  response_code: { type: string }
